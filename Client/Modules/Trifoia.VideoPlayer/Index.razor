@namespace Trifoia.VideoPlayer
@using Blazored.Video
@using Blazored.Video.Support
@inherits ModuleBase
@inject ISettingService SettingService
@inject IStringLocalizer<Index> Localizer
@inject SiteState SiteState

<BlazoredVideo Play="OnPlay"
        class="w-100"
        style="max-width:800px;"
        controls="controls">
    <source 
        src="@_source"
        type="@_type" />
</BlazoredVideo>
    
@code {
    private string _source ;
    private string _type ;
    private const string DefaultSource = "https://res.cloudinary.com/blazoredgitter/video/upload/v1557015491/samples/elephants.mp4";
    private const string DefaultType = "video/mp4";

    protected override async Task OnInitializedAsync()
    {
  
        try
        {
            Dictionary<string, string> settings = await SettingService.GetModuleSettingsAsync(ModuleState.ModuleId);
            _source = SettingService.GetSetting(settings, "source", DefaultSource);
            _type = SettingService.GetSetting(settings, "type", DefaultType);

        }
        catch (Exception ex)
        {
            ModuleInstance.AddModuleMessage(ex.Message, MessageType.Error);
        }
    }

    void OnPlay(VideoState state)
    {
        SiteState.Properties.VideoState = new VideoState();
    }

}